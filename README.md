# German Learning App

A full-stack app for studying and practising German A1 vocabulary and grammar. Source material lives in `data/`, a React frontend serves the study experience, a Python ingestion pipeline generates exercises via Amazon Bedrock, and a CDK stack provisions all AWS infrastructure.

## Repo structure

```
german_learning/
├── data/a1/                    # Source markdown files (edit these to add content)
│   ├── German_Lesson_Summary.md
│   ├── German_Nouns.md
│   └── German_Verbs.md
├── frontend/                   # React + Vite + TypeScript web app
├── ingestion/                  # Python pipeline: data processing + AWS Lambda handlers
├── infrastructure/             # AWS CDK stack (TypeScript)
└── amplify.yml                 # AWS Amplify build config
```

## How it works

### Study mode

The frontend fetches static markdown files (split and merged by the ingestion scripts at build time) and renders them with full table support. Three views: Lessons, Nouns, Verbs.

### Exercise mode

Exercises are pre-generated by an AWS Lambda that reads the source files from S3, calls **Amazon Bedrock** (Claude Haiku) to produce structured questions, and stores the results in **DynamoDB**. The frontend fetches them via **API Gateway**.

```
data/a1/*.md
    │
    ├─► Amplify build (preBuild)
    │       python3 ingestion/split_lessons.py
    │       python3 ingestion/merge_tables.py
    │       → frontend/public/data/a1/  (served as static assets)
    │
    └─► aws s3 sync → S3 raw bucket
                │
            S3 event → Lambda (ingestion)
                │
            Bedrock (Claude Haiku) → DynamoDB
                │
            API Gateway ← Frontend /exercise
```

### Exercise API

```
GET /exercises/a1              all questions (~630)
GET /exercises/a1?type=nouns   noun questions only
GET /exercises/a1?type=verbs   verb questions only
GET /exercises/a1?type=lesson  lesson grammar questions only
```

## Prerequisites

- Node.js 20+
- Python 3.12+
- AWS CLI configured (`aws configure`)
- AWS CDK bootstrapped (`cdk bootstrap`)

## Quickstart (local dev)

```bash
# 1. Generate static data files
python3 ingestion/split_lessons.py
python3 ingestion/merge_tables.py

# 2. Run the frontend
cd frontend
npm install
npm run dev
```

The study section works fully offline. The exercise section requires a deployed backend (see below).

## Deploying to AWS

```bash
# 1. Deploy the CDK stack
cd infrastructure
npm install
npx cdk deploy

# Note the outputs:
#   RawBucketName       → use in the aws s3 sync command below
#   ExercisesApiUrl     → set as VITE_EXERCISES_API_URL in Amplify Console

# 2. Upload source files to trigger exercise generation
aws s3 sync data/a1/ s3://<RawBucketName>/a1/ --exclude "LLM_INSTRUCTION_SET.md"
# Lambda triggers automatically → exercises appear in DynamoDB after ~4 min

# 3. Connect repo to AWS Amplify Console
#    Set VITE_EXERCISES_API_URL environment variable to the ExercisesApiUrl output
```

## Adding new content

1. Edit the files in `data/a1/`
2. Upload to S3 to trigger exercise regeneration:
   ```bash
   aws s3 sync data/a1/ s3://<RawBucketName>/a1/ --exclude "LLM_INSTRUCTION_SET.md"
   ```
3. Amplify rebuilds the frontend automatically on push to `main` (study content updated)
